<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>HITB2018线上赛——Mobile | W4ter5heep&#39;s site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CTF,Mobile">
    <meta name="description" content="最近参加了HITB2018，主要做了两道Mobile，简单整理题目。 multicheck题目提示:Check！Check！Check！大概是有陷阱。 安装apk，没有多余的提示，输入flag，进行验证。首先jeb分析下java部分：">
<meta name="keywords" content="CTF,Mobile">
<meta property="og:type" content="article">
<meta property="og:title" content="HITB2018线上赛——Mobile">
<meta property="og:url" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/index.html">
<meta property="og:site_name" content="W4ter5heep&#39;s site">
<meta property="og:description" content="最近参加了HITB2018，主要做了两道Mobile，简单整理题目。 multicheck题目提示:Check！Check！Check！大概是有陷阱。 安装apk，没有多余的提示，输入flag，进行验证。首先jeb分析下java部分：">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523800589774.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523800625353.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523800798055.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523801512694.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523801879224.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523801940574.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523802539119.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523803089035.png">
<meta property="og:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523803110977.png">
<meta property="og:updated_time" content="2018-04-15T15:23:12.878Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HITB2018线上赛——Mobile">
<meta name="twitter:description" content="最近参加了HITB2018，主要做了两道Mobile，简单整理题目。 multicheck题目提示:Check！Check！Check！大概是有陷阱。 安装apk，没有多余的提示，输入flag，进行验证。首先jeb分析下java部分：">
<meta name="twitter:image" content="http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/1523800589774.png">
    
        <link rel="alternate" type="application/atom+xml" title="W4ter5heep&#39;s site" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/gogo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">W4ter5heep</h5>
          <a href="mailto:w4ter5heep@qq.com" title="w4ter5heep@qq.com" class="mail">w4ter5heep@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/w4ter5heep" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friendlinks"  >
                <i class="icon icon-lg icon-address-book"></i>
                友链
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">HITB2018线上赛——Mobile</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="global.search_input_hint">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">HITB2018线上赛——Mobile</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-04-15T15:16:39.000Z" itemprop="datePublished" class="page-time">
  2018-04-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WriteUp/">WriteUp</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#multicheck"><span class="post-toc-number">1.</span> <span class="post-toc-text">multicheck</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#kivy-simple"><span class="post-toc-number">2.</span> <span class="post-toc-text">kivy simple</span></a></li></ol>
        </nav>
    </aside>


<article id="post-HITB2018线上赛——Mobile"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">HITB2018线上赛——Mobile</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-04-15 23:16:39" datetime="2018-04-15T15:16:39.000Z"  itemprop="datePublished">2018-04-15</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WriteUp/">WriteUp</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>最近参加了HITB2018，主要做了两道Mobile，简单整理题目。</p>
<h2 id="multicheck"><a href="#multicheck" class="headerlink" title="multicheck"></a>multicheck</h2><p>题目提示:Check！Check！Check！<br>大概是有陷阱。</p>
<p>安装apk，没有多余的提示，输入flag，进行验证。<br>首先jeb分析下java部分：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523800589774.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>方法通过就可以了。<br>首先看到了上面：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523800625353.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>似乎加载了一个方法。<br>解压apk包，找到assets中的claz.dex，赶快用jeb打开：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523800798055.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>好像有flag，赶快手动排序得到了<strong>假的flag</strong>，提示大概是this is certainly not the flag，确实是坑。</p>
<p>只能继续分析so文件libcheck.so<br>JNI_OnLoad也没有有用信息，只能挨个看sub函数<br>找到sub_1380<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523801512694.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>注意这一段，好像进行了解密和文件的替换，byte_4004^v9并赋值到v8即是对claz.dex文件的替换。<br>将byte_4004部分数据dump出来进行解密。保存为.dex，会发现是可以被解析的。可能就是真正的check。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523801879224.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523801940574.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>这部分的调用还是稍微有些复杂的，分析了半天本来想爆破的，但是注意到了一个特殊值，即：v5 = -1640531527，查看16进制：0x9E3779B9<br>搜索发现是Tea加密的特征值。直接从网上找可用的Tea加解密程序。过程十分曲折，找到的一些版本的程序，但是加解密结果各不相同，有点崩溃。。。终于找到一个较为标准的Java版，得到了结果。编程水平太差，只能复制粘贴，惭愧。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523802539119.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>脚本如下：<br>生成.dex的脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">a = [0x8D,0x8F,0x93,0xE6,0xDD,0xDD,0xDA,0xF0,0x74,0xF2,0x03,0x6D,0xC0,0xD3,0x07,0x29,</span><br><span class="line">0x9A,0x97,0xB7,0x3D,0xD6,0x0B,0xBC,0x53,0xF4,0x89,0x8E,0x08,0x21,0x52,0xE9,0x42,</span><br><span class="line">0x35,0x0D,0x0B,0x0C,0x7D,0x0E,0x0F,0x10,0x69,0x44,0x27,0x06,0x15,0x16,0x17,0x18,</span><br><span class="line">0x19,0x1A,0x1B,0x1C,0x81,0x18,0x1F,0x20,0x3D,0x22,0x23,0x24,0x55,0x26,0x27,0x28,</span><br><span class="line">0x22,0x2A,0x2B,0x2C,0xCD,0x2E,0x2F,0x30,0x3B,0x32,0x33,0x34,0x39,0x37,0x37,0x38,</span><br><span class="line">0x3B,0x3A,0x3B,0x3C,0xB9,0x3F,0x3F,0x40,0x4D,0x42,0x43,0x44,0xD1,0x47,0x47,0x48,</span><br><span class="line">0x48,0x4A,0x4B,0x4C,0xB9,0x4F,0x4F,0x50,0x79,0x57,0x53,0x54,0x41,0x54,0x57,0x58,</span><br><span class="line">0x75,0x5F,0x5B,0x5C,0x6B,0x5B,0x5F,0x60,0x5F,0x67,0x63,0x64,0x24,0x63,0x67,0x68,</span><br><span class="line">0x24,0x6F,0x6B,0x6C,0x3D,0x6B,0x6F,0x70,0x25,0x77,0x73,0x74,0x22,0x73,0x77,0x78,</span><br><span class="line">0x22,0x7F,0x7B,0x7C,0x1D,0x7B,0x7F,0x80,0xE6,0x87,0x83,0x84,0xF3,0x83,0x87,0x88,</span><br><span class="line">0x03,0x8F,0x8B,0x8C,0x13,0x8B,0x8F,0x90,0x23,0x97,0x93,0x94,0x53,0x93,0x97,0x98,</span><br><span class="line">0x50,0x9F,0x9B,0x9C,0x4C,0x9B,0x9F,0xA0,0x75,0xA7,0xA3,0xA4,0x7D,0xA3,0xA7,0xA8,</span><br><span class="line">0x74,0xAF,0xAB,0xAC,0x4C,0xAB,0xAF,0xB0,0x54,0xB7,0xB3,0xB4,0x5D,0xB3,0xB7,0xB8,</span><br><span class="line">0x4A,0xBF,0xBB,0xBC,0x4B,0xBB,0xBF,0xC0,0x3C,0xC7,0xC3,0xC4,0xC0,0xC0,0xC7,0xC8,</span><br><span class="line">0xCB,0xCA,0xCB,0xCC,0xC9,0xCE,0xCF,0xD0,0xDB,0xD2,0xD3,0xD4,0xDE,0xD6,0xD7,0xD8,</span><br><span class="line">0xD5,0xDA,0xDB,0xDC,0xD0,0xDE,0xDF,0xE0,0xEF,0xE2,0xE3,0xE4,0xEA,0xE6,0xE7,0xE8,</span><br><span class="line">0xF8,0xEA,0xEB,0xEC,0xF9,0xEE,0xEF,0xF0,0xE4,0xF2,0xF3,0xF4,0xF0,0xF6,0xF7,0xF8,</span><br><span class="line">0xF8,0xFA,0xFB,0xFC,0x1D,0xFA,0xFF,0x00,0x0E,0x02,0x03,0x04,0x02,0x06,0x07,0x08,</span><br><span class="line">0x09,0x0A,0x0B,0x0C,0x1D,0x0E,0x0F,0x10,0x16,0x12,0x13,0x14,0xFD,0x12,0x17,0x18,</span><br><span class="line">0x0B,0x1A,0x1B,0x1C,0x15,0x1E,0x1F,0x20,0xD9,0x26,0x23,0x24,0x36,0x26,0x27,0x28,</span><br><span class="line">0x21,0x2A,0x2B,0x2C,0x2D,0x2B,0x2F,0x30,0x37,0x32,0x33,0x34,0x3C,0x36,0x37,0x38,</span><br><span class="line">0x39,0x3A,0x3B,0x3C,0x3A,0x3E,0x3F,0x40,0x48,0x42,0x43,0x44,0x4D,0x43,0x47,0x48,</span><br><span class="line">0x40,0x4A,0x4B,0x4C,0x44,0x4E,0x4F,0x50,0x41,0x57,0x53,0x54,0x5D,0x56,0x57,0x58,</span><br><span class="line">0x50,0x5A,0x5B,0x5C,0x41,0x5B,0x5F,0x60,0x69,0x62,0x63,0x64,0x6F,0x66,0x67,0x68,</span><br><span class="line">0x4D,0x6F,0x6B,0x6C,0x6F,0x6E,0x65,0x70,0x67,0x72,0x73,0x74,0x77,0x76,0x7E,0x78,</span><br><span class="line">0x61,0x7A,0x7B,0x7C,0x7F,0x7E,0x7E,0x80,0x81,0x82,0x83,0x84,0x87,0x86,0x86,0x88,</span><br><span class="line">0x88,0x8A,0x8B,0x8C,0x8F,0x8E,0x8F,0x90,0x87,0x92,0x93,0x94,0x97,0x96,0x91,0x98,</span><br><span class="line">0x8F,0x9A,0x9B,0x9C,0x9F,0x9E,0x98,0xA0,0xB7,0xA2,0xA3,0xA4,0xA7,0xA6,0xAF,0xA8,</span><br><span class="line">0xBF,0xAA,0xAB,0xAC,0xAF,0xAE,0xA6,0xB0,0xA7,0xB2,0xB3,0xB4,0xB7,0xB6,0xB4,0xB8,</span><br><span class="line">0xA0,0xBA,0xBB,0xBC,0xBE,0xBE,0xBE,0xC0,0xC0,0xC2,0xC3,0xC4,0xC1,0xC6,0xC2,0xC8,</span><br><span class="line">0xD2,0xCA,0xCB,0xCC,0xC8,0xCE,0xCD,0xD0,0xC6,0xD2,0xD3,0xD4,0xD3,0xD6,0xD3,0xD8,</span><br><span class="line">0xC3,0xDA,0xDB,0xDC,0xDF,0xDE,0xDF,0xE0,0xE0,0xE2,0xE3,0xE4,0xE6,0xE6,0xE7,0xE8,</span><br><span class="line">0xE9,0xEA,0xEB,0xEC,0xEE,0xEE,0xEF,0xF0,0xF1,0xF2,0xF3,0xF4,0x85,0xF0,0xF7,0xF8,</span><br><span class="line">0xF9,0xFA,0xFB,0xFC,0xFC,0xFE,0xFF,0x00,0x01,0x02,0x03,0x04,0x0A,0x00,0x07,0x08,</span><br><span class="line">0x3B,0x0A,0x0B,0x0C,0x1F,0x4E,0x2C,0x10,0x1B,0x12,0x35,0x14,0x1A,0x16,0x17,0x18,</span><br><span class="line">0x70,0x1A,0x1B,0x1C,0x0E,0x1E,0x3F,0x20,0x02,0x22,0x2A,0x24,0x03,0x26,0x35,0x28,</span><br><span class="line">0x29,0x2A,0x42,0x2C,0x2C,0x2E,0x21,0x30,0x31,0x31,0x37,0x34,0x31,0x36,0x37,0x38,</span><br><span class="line">0x92,0x91,0x90,0x97,0xF0,0xF3,0xF2,0x8D,0xAE,0xAD,0xAC,0xAB,0x3D,0x10,0x73,0x5A,</span><br><span class="line">0x49,0x49,0x4A,0x4C,0x6D,0x4E,0x4F,0x50,0x32,0x2E,0x36,0xBD,0xDB,0x07,0x86,0x81,</span><br><span class="line">0xC3,0x15,0x4D,0x68,0x84,0xFC,0xE1,0xD8,0x04,0x8C,0x2A,0x81,0x50,0x9D,0x49,0x84,</span><br><span class="line">0x08,0x61,0xA3,0x48,0x80,0xA1,0xFF,0xC5,0x70,0x72,0x72,0x74,0x74,0x76,0x77,0x78,</span><br><span class="line">0x64,0x7C,0x7B,0x7C,0x79,0x7E,0x7F,0x80,0xF1,0x92,0x8B,0x84,0x85,0x86,0x89,0x88,</span><br><span class="line">0x88,0x8A,0x8A,0x8C,0x8D,0x8E,0x8F,0x90,0xB3,0x94,0x93,0x94,0x90,0x96,0x97,0x98,</span><br><span class="line">0xA2,0x9A,0x9F,0x9C,0x4D,0x9E,0x9F,0xA1,0xAE,0xA2,0xA3,0xA4,0xA2,0xA6,0xA6,0xA8,</span><br><span class="line">0xAC,0xAA,0xAB,0xAC,0x86,0xA8,0xAF,0xB0,0x98,0xB2,0xB3,0xB4,0xA7,0xB7,0x96,0xD8,</span><br><span class="line">0x65,0xBA,0xBB,0xB4,0x64,0xBE,0xBF,0xC8,0xE0,0xA0,0x73,0xC6,0xE6,0xE4,0xCE,0xC8,</span><br><span class="line">0x44,0xC9,0x84,0xCF,0xCF,0xCF,0xEE,0xB3,0xA0,0x81,0xD9,0xD4,0xC3,0xD4,0xF6,0xF8,</span><br><span class="line">0xFA,0xD9,0xD2,0xDC,0xDC,0xCE,0xFE,0xD4,0xD4,0xA2,0xF1,0xE4,0x87,0xE2,0xE7,0xE8,</span><br><span class="line">0xFA,0xEF,0xCB,0xEC,0x9C,0xAE,0xEB,0xF0,0xF3,0xA6,0xFF,0xF0,0xE6,0xF3,0xFF,0xF8,</span><br><span class="line">0x88,0xAF,0xF1,0xFC,0xE9,0xFD,0x27,0x00,0x01,0x0A,0x2B,0xEA,0x14,0x05,0x07,0x08,</span><br><span class="line">0x19,0x0A,0x0F,0x0C,0x0F,0x0E,0x0F,0x10,0x2B,0x14,0x13,0x14,0x56,0x16,0x17,0x18,</span><br><span class="line">0x68,0x3A,0x1D,0x1C,0xC1,0x1E,0x13,0x24,0x33,0x22,0x67,0x27,0x21,0x26,0x35,0x38,</span><br><span class="line">0x6D,0x28,0x2F,0x2C,0x3F,0x2F,0x3B,0x35,0x88,0x4B,0x04,0xAA,0x27,0x36,0x73,0x3E,</span><br><span class="line">0x37,0x3A,0x29,0x2C,0x79,0x39,0x31,0x40,0x53,0x62,0x07,0x4C,0x4B,0x46,0x55,0x78,</span><br><span class="line">0x0D,0x43,0x45,0x4C,0x5F,0x4E,0x7A,0xA0,0x4D,0x52,0xE3,0x05,0xB5,0x5C,0x55,0x5C,</span><br><span class="line">0xE9,0x30,0xCB,0x57,0x5F,0x5F,0xE8,0xDA,0x80,0x69,0x61,0x61,0xD5,0x1D,0xD0,0xD2,</span><br><span class="line">0xD9,0xC9,0x8B,0x66,0x6E,0x6A,0xDF,0xFA,0xE1,0x79,0x70,0x75,0xC2,0xCC,0x96,0x73,</span><br><span class="line">0x7A,0x7F,0xCB,0xE7,0xCA,0xC4,0xCF,0x22,0x59,0x82,0x83,0x85,0xAD,0x63,0x95,0x88,</span><br><span class="line">0xC2,0x89,0x8F,0x8C,0x9F,0x9E,0xC4,0x92,0x95,0x92,0x81,0x94,0xE4,0xB6,0x92,0x98,</span><br><span class="line">0x9D,0x9A,0x97,0x9C,0x8C,0x9E,0x9F,0xA0,0xA7,0xA2,0xA1,0xA4,0xA5,0xA6,0xA7,0xA8,</span><br><span class="line">0xE7,0xAC,0xAB,0xAC,0x9A,0xAE,0xAF,0xB0,0x90,0xF2,0x53,0xB4,0xB5,0xB4,0x94,0xB9,</span><br><span class="line">0xB0,0xBA,0xA9,0xBC,0x9C,0xAC,0x8A,0xE5,0xEE,0xC2,0x1B,0xC6,0xC0,0xC5,0x83,0xCB,</span><br><span class="line">0xCD,0xCA,0x1E,0xFF,0x32,0xCE,0x42,0xE3,0x9E,0xD1,0xD2,0xD6,0x0D,0xD4,0xD2,0xDA,</span><br><span class="line">0x9D,0xD9,0xDF,0xDC,0x3C,0xDD,0xDC,0xE8,0x34,0xD1,0x1C,0xE4,0x68,0xD5,0xA8,0xEB,</span><br><span class="line">0xE8,0xE8,0x33,0xEE,0xE8,0xEF,0xAB,0xF3,0xF5,0xF2,0x12,0xF7,0xF6,0xE6,0x22,0xCB,</span><br><span class="line">0x06,0xFA,0x76,0xCF,0xB2,0xFD,0xFE,0x02,0x45,0x00,0x07,0x04,0xE4,0x04,0x05,0x10,</span><br><span class="line">0xDC,0x28,0xF4,0x0C,0x80,0x2C,0x40,0x12,0x10,0x17,0xCB,0x14,0x15,0x17,0xCF,0x1D,</span><br><span class="line">0x1C,0x1E,0x33,0xCD,0x0C,0x1F,0x1F,0x20,0x27,0x22,0x21,0x24,0x24,0x26,0x27,0x28,</span><br><span class="line">0x75,0x2C,0x2B,0x2C,0x19,0x2E,0x2F,0x30,0x10,0x72,0xD2,0x34,0x35,0x34,0x14,0x39,</span><br><span class="line">0x33,0x3A,0x29,0x3C,0x1C,0x7C,0x0A,0x65,0x6D,0x42,0x9B,0x46,0x40,0x45,0x0F,0x4A,</span><br><span class="line">0x4D,0x48,0x3A,0x5C,0x4F,0x4E,0x4D,0x50,0x5B,0x50,0x8B,0x57,0x50,0x54,0x1F,0x5B,</span><br><span class="line">0x5D,0x59,0x2A,0x4C,0x5F,0x5E,0x5C,0x60,0x6B,0x61,0x83,0x67,0x66,0x6E,0xD1,0x5A,</span><br><span class="line">0xB1,0x69,0x6E,0x6D,0x25,0x6D,0x6B,0x73,0x00,0x62,0x71,0x74,0x76,0x76,0x7D,0x7B,</span><br><span class="line">0x99,0x79,0x78,0x6C,0xCB,0x4C,0x37,0x83,0x85,0x87,0x63,0x87,0x86,0x9E,0x31,0xBA,</span><br><span class="line">0xC2,0x88,0x8A,0x8C,0x55,0x8E,0x8F,0x91,0x49,0x97,0x96,0x90,0xBD,0x42,0x86,0x99,</span><br><span class="line">0x9A,0x9A,0x9A,0x9C,0x9F,0x9E,0x9F,0xA0,0xCB,0xA4,0xA3,0xA4,0xAA,0xA6,0xA7,0xA8,</span><br><span class="line">0xC7,0xBA,0xA2,0xAC,0xAF,0xAE,0xA3,0xB0,0xC0,0xA2,0xB0,0xB4,0xB5,0xB6,0xBB,0xB8,</span><br><span class="line">0xDB,0xBB,0xBA,0xBC,0xCC,0x9E,0xB4,0xC0,0xD1,0xC2,0xC9,0xC4,0xCA,0xC6,0xC7,0xC8,</span><br><span class="line">0xC8,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,0xD0,0xD4,0xD2,0xD3,0xD4,0xD6,0xD6,0xD6,0xD8,</span><br><span class="line">0xDA,0xDA,0xDA,0xDC,0xDC,0xDE,0xDF,0xE0,0xE0,0xE2,0xE3,0xE4,0xE1,0xE6,0xE7,0xE8,</span><br><span class="line">0xEB,0xEA,0xEB,0xEC,0xE4,0xEE,0xE6,0xF0,0xF0,0xF2,0xF3,0xF4,0xFC,0xF6,0xF7,0xF8,</span><br><span class="line">0xFD,0xFA,0xFB,0xFC,0xF4,0xFE,0xFE,0x00,0x0B,0x02,0x02,0x04,0x07,0x06,0x07,0x08,</span><br><span class="line">0x03,0x0A,0x0A,0x0C,0x0F,0x0E,0x0F,0x10,0x18,0x12,0x12,0x14,0x1D,0x2A,0x74,0x74,</span><br><span class="line">0x70,0x74,0x72,0x68,0x23,0x1E,0x19,0x1C,0x48,0x4C,0x4A,0x50,0x1B,0x26,0x26,0x6A,</span><br><span class="line">0x29,0x20,0x68,0x44,0x48,0x4D,0x44,0x1E,0x5B,0x53,0x45,0x55,0x35,0x37,0x7E,0x38,</span><br><span class="line">0x3B,0x73,0x79,0x3C,0x3C,0x72,0x3F,0x42,0x0D,0x0E,0x43,0x47,0x09,0x0A,0x0E,0x48,</span><br><span class="line">0x4C,0x06,0x07,0x05,0x01,0x07,0x4F,0x5D,0x1D,0x31,0x3C,0x39,0x7A,0x37,0x78,0x1B,</span><br><span class="line">0x31,0x3F,0x38,0x37,0x66,0x5E,0x4D,0x2C,0x0B,0x03,0x15,0x05,0x4A,0x0A,0x06,0x06,</span><br><span class="line">0x0E,0x45,0x24,0x0E,0x07,0x0B,0x0C,0x04,0x4A,0x72,0x61,0x38,0x1F,0x17,0x01,0x19,</span><br><span class="line">0x56,0x16,0x1A,0x12,0x1A,0x51,0x2C,0xF4,0xF3,0xEB,0xED,0xE3,0xBE,0x86,0x95,0xC4,</span><br><span class="line">0xE3,0xEB,0xFD,0xED,0xA2,0xE2,0xEE,0xFE,0xF6,0xBD,0xC0,0xED,0xE6,0xE2,0xF2,0xF5,</span><br><span class="line">0xA2,0x9A,0x89,0xD0,0xF7,0xFF,0xE9,0xC1,0x8E,0xD7,0xD7,0xCD,0xC9,0x89,0xE6,0xDA,</span><br><span class="line">0xDB,0xCB,0xD2,0xDF,0x96,0xAE,0xAE,0xE6,0xB1,0xB4,0xE5,0xF8,0xFC,0xFA,0xFE,0xF1,</span><br><span class="line">0xB9,0xBB,0xE1,0xBC,0xBF,0xE4,0xF3,0xC0,0xC2,0x98,0x8F,0x88,0xC5,0xC4,0x9C,0x8A,</span><br><span class="line">0xC9,0xC8,0x90,0x85,0xCD,0xCF,0xAE,0xD0,0xD8,0xB3,0xA1,0xA6,0xB4,0xAF,0xB4,0xB7,</span><br><span class="line">0xA9,0xA3,0xDB,0xDD,0xBF,0xDE,0xDA,0x83,0x89,0x87,0x80,0x8F,0xE5,0xE0,0x82,0x99,</span><br><span class="line">0x9C,0x8B,0x87,0x9F,0xED,0xE6,0x88,0x95,0x85,0xB0,0x8A,0x80,0x90,0x85,0xF7,0xC4,</span><br><span class="line">0xF9,0xFD,0xF5,0xFE,0xE8,0x78,0xFD,0x6B,0xA5,0x00,0x16,0xC6,0x05,0x03,0x07,0x0F,</span><br><span class="line">0x07,0x0A,0x38,0x0D,0x0D,0x09,0x01,0x1F,0x3C,0x3C,0x13,0x50,0x14,0x16,0x10,0x05,</span><br><span class="line">0x43,0x51,0x27,0x57,0x56,0x22,0x98,0x77,0x1E,0x22,0x2B,0x20,0x25,0x26,0x27,0x28,</span><br><span class="line">0x2E,0x24,0x60,0x54,0x11,0xEA,0x12,0x2E,0x85,0x9D,0x72,0x08,0x09,0x36,0x10,0x3A,</span><br><span class="line">0x39,0x3A,0x3C,0x32,0x67,0x75,0xA9,0xF4,0xF5,0xD3,0x1C,0x44,0x59,0x44,0x47,0x48,</span><br><span class="line">0x4E,0x44,0x11,0x07,0x4C,0x59,0x40,0x8E,0x0C,0x52,0x07,0x55,0x55,0x51,0x59,0x58,</span><br><span class="line">0x5B,0x5A,0x53,0x5C,0x5D,0x54,0x5E,0x6A,0x61,0xEA,0xE3,0x60,0xF1,0x62,0x66,0xE9,</span><br><span class="line">0xE9,0x6E,0xE3,0x69,0x6C,0x64,0xCF,0x75,0x70,0x7B,0xCF,0x71,0x74,0x7E,0xD7,0x7E,</span><br><span class="line">0x78,0x70,0xC3,0x7B,0x7C,0x74,0xC7,0x88,0x80,0x8B,0x33,0x8D,0x88,0x86,0x87,0x88,</span><br><span class="line">0x89,0x8A,0x8B,0x8C,0x8C,0x8E,0x8F,0x90,0x91,0x92,0x93,0x94,0x94,0x96,0x97,0x98,</span><br><span class="line">0x85,0x9A,0x9B,0x9C,0xED,0x9E,0x9F,0xA0,0xA3,0xA2,0xA3,0xA4,0xAE,0xA6,0xA7,0xA8,</span><br><span class="line">0x49,0xAA,0xAB,0xAC,0xAE,0xAE,0xAF,0xB0,0xBB,0xB2,0xB3,0xB4,0xB9,0xB7,0xB7,0xB8,</span><br><span class="line">0xBD,0xBA,0xBB,0xBC,0xBF,0xBE,0xBF,0xC0,0x45,0xC3,0xC3,0xC4,0xC0,0xC6,0xC7,0xC8,</span><br><span class="line">0xC5,0xCA,0xCB,0xCC,0x59,0xCF,0xCF,0xD0,0xD7,0xD2,0xD3,0xD4,0xD4,0xD6,0xD7,0xD8,</span><br><span class="line">0x2D,0xDB,0xDB,0xDC,0xDC,0xFE,0xDF,0xE0,0xE9,0xE2,0xE3,0xE4,0xF1,0xE4,0xE7,0xE8,</span><br><span class="line">0xE8,0xFA,0xEB,0xEC,0xE5,0xEE,0xEF,0xF0,0x11,0xF6,0xF3,0xF4,0xF7,0xD6,0xF7,0xF8,</span><br><span class="line">0xE5,0xFA,0xFB,0xFC,0xD1,0xFB,0xFF,0x00,0x02,0x22,0x03,0x04,0x0D,0x06,0x07,0x08,</span><br><span class="line">0x06,0x0C,0x0B,0x0C,0x0D,0x2E,0x0F,0x10,0x10,0x12,0x13,0x14,0x65,0x10,0x17,0x18,</span><br><span class="line">0x19,0x0A,0x1B,0x1C,0x1C,0x1E,0x1F,0x20,0xBD,0x24,0x23,0x24]</span><br><span class="line"></span><br><span class="line">v9 = 233</span><br><span class="line">out = &quot;&quot;</span><br><span class="line">for i in range(0x73c):</span><br><span class="line">    tmp = (a[i]^v9)&amp;0xFF</span><br><span class="line">    out += chr(tmp)</span><br><span class="line">    v9 += 1</span><br><span class="line"></span><br><span class="line">fp = open(&quot;claz2.dex&quot;, &quot;wb&quot;)</span><br><span class="line">fp.write(out)</span><br><span class="line">fp.close()</span><br></pre></td></tr></table></figure></p>
<p>Tea的加解密程序：<br>该java版本还是较为标准的实现，可以收藏。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">package hitb2018;</span><br><span class="line"></span><br><span class="line">public class Tea &#123;</span><br><span class="line">    private final static int[] KEY = new int[]&#123;//加密解密所用的KEY</span><br><span class="line">        0xABABABAB, 0xCDCDCDCD,</span><br><span class="line">        0xEFEFEFEF, 0x12345678</span><br><span class="line">    &#125;;</span><br><span class="line">    //加密</span><br><span class="line">    public static byte[] encrypt(byte[] content, int offset, int[] key, int times)&#123;//times为加密轮数</span><br><span class="line">        int[] tempInt = byteToInt(content, offset);</span><br><span class="line">        int y = tempInt[0], z = tempInt[1], sum = 0, i;</span><br><span class="line">        int delta=0x9e3779b9; //这是算法标准给的值</span><br><span class="line">        int a = key[0], b = key[1], c = key[2], d = key[3]; </span><br><span class="line"></span><br><span class="line">        for (i = 0; i &lt; times; i++) &#123;   </span><br><span class="line">            </span><br><span class="line">            sum += delta;</span><br><span class="line">            y += ((z&lt;&lt;4) + a) ^ (z + sum) ^ ((z&gt;&gt;5) + b);</span><br><span class="line">            z += ((y&lt;&lt;4) + c) ^ (y + sum) ^ ((y&gt;&gt;5) + d);</span><br><span class="line">        &#125;</span><br><span class="line">        tempInt[0]=y;</span><br><span class="line">        tempInt[1]=z; </span><br><span class="line">        return intToByte(tempInt, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    //解密</span><br><span class="line">    public static byte[] decrypt(byte[] encryptContent, int offset, int[] key, int times)&#123;</span><br><span class="line">        int[] tempInt = byteToInt(encryptContent, offset);</span><br><span class="line">        int y = tempInt[0], z = tempInt[1], sum = 0, i;</span><br><span class="line">        int delta=0x9e3779b9; //这是算法标准给的值</span><br><span class="line">        int a = key[0], b = key[1], c = key[2], d = key[3];</span><br><span class="line">        if (times == 32)</span><br><span class="line">            sum = 0xC6EF3720; /* delta &lt;&lt; 5*/</span><br><span class="line">        else if (times == 16)</span><br><span class="line">            sum = 0xE3779B90; /* delta &lt;&lt; 4*/</span><br><span class="line">        else</span><br><span class="line">            sum = delta * times;</span><br><span class="line"></span><br><span class="line">        for(i = 0; i &lt; times; i++) &#123; </span><br><span class="line">            z -= ((y&lt;&lt;4) + c) ^ (y + sum) ^ ((y&gt;&gt;5) + d);</span><br><span class="line">            y -= ((z&lt;&lt;4) + a) ^ (z + sum) ^ ((z&gt;&gt;5) + b);</span><br><span class="line">            sum -= delta; </span><br><span class="line">        &#125;</span><br><span class="line">        tempInt[0] = y;</span><br><span class="line">        tempInt[1] = z;</span><br><span class="line"></span><br><span class="line">        return intToByte(tempInt, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    //byte[]型数据转成int[]型数据</span><br><span class="line">    private static int[] byteToInt(byte[] content, int offset)&#123;</span><br><span class="line"></span><br><span class="line">        int[] result = new int[content.length &gt;&gt; 2];//除以2的n次方 == 右移n位 即 content.length / 4 == content.length &gt;&gt; 2</span><br><span class="line">        for(int i = 0, j = offset; j &lt; content.length; i++, j += 4)&#123;</span><br><span class="line">            result[i] = transform(content[j + 3]) | transform(content[j + 2]) &lt;&lt; 8 |</span><br><span class="line">            transform(content[j + 1]) &lt;&lt; 16 | (int)content[j] &lt;&lt; 24;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    //int[]型数据转成byte[]型数据</span><br><span class="line">    private static byte[] intToByte(int[] content, int offset)&#123;</span><br><span class="line">        byte[] result = new byte[content.length &lt;&lt; 2];//乘以2的n次方 == 左移n位 即 content.length * 4 == content.length &lt;&lt; 2</span><br><span class="line">        for(int i = 0, j = offset; j &lt; result.length; i++, j += 4)&#123;</span><br><span class="line">            result[j + 3] = (byte)(content[i] &amp; 0xff);</span><br><span class="line">            result[j + 2] = (byte)((content[i] &gt;&gt; 8) &amp; 0xff);</span><br><span class="line">            result[j + 1] = (byte)((content[i] &gt;&gt; 16) &amp; 0xff);</span><br><span class="line">            result[j] = (byte)((content[i] &gt;&gt; 24) &amp; 0xff);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    //若某字节为负数则需将其转成无符号正数</span><br><span class="line">    private static int transform(byte temp)&#123;</span><br><span class="line">        int tempInt = (int)temp;</span><br><span class="line">        if(tempInt &lt; 0)&#123;</span><br><span class="line">            tempInt += 256;</span><br><span class="line">        &#125;</span><br><span class="line">        return tempInt;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        byte[] enContent = new byte[]&#123;99, 124, 101, -23, -114, 81, -47, -39, -102, 79, 22, 52, -39, -94, -66, -72, 101, -18, 73, -27, 53, -5, 46, -20, 97, 11, -56, 36, -19, -49, -112, -75&#125;;</span><br><span class="line">        for(int j=0;j&lt;4;j++)&#123;</span><br><span class="line">            byte[] deContent = decrypt(enContent,j*8,KEY,32);</span><br><span class="line">            for(int i = 0;i &lt; 8;i++)&#123;</span><br><span class="line">                System.out.print((char)deContent[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实对整个程序的动态加载和替换过程还不是很了解。<br>题目有点小坑，但是还能接受。<br><strong>HITB{SEe!N9_IsN’T_bELIEV1Ng}</strong></p>
<h2 id="kivy-simple"><a href="#kivy-simple" class="headerlink" title="kivy simple"></a>kivy simple</h2><p>apk包有点大，但是安装以后也没有特别的功能。首先搜索kivy，kivy是使用python进行全平台应用开发的框架，该apk也是使用该python框架进行开发的，通过JEB对java代码以及IDA对so文件的分析，并没有发现程序的主逻辑。<br>进一步，通过学习kivy框架的开发以及程序打包流程，同时注意到了解压缩后在assets中的private.mp3文件，猜测为压缩包。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523803089035.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>修改文件名后缀，解压得到部分文件(这里注意，在不同平台下可能要解压两次，比如windows下)<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./1523803110977.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br>找到了python 编写的主函数等文件<br>使用uncompyle6对main.pyo得到main.py：<br>其中有一段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def check(self):</span><br><span class="line">    if self.flag.text == &apos;HITB&#123;this_is_not_flag&#125;&apos;:</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">def auth(self, instance):</span><br><span class="line">    if self.check():</span><br><span class="line">        s = &apos;Congratulations you got the flag&apos;</span><br><span class="line">    else:</span><br><span class="line">        s = &apos;Wrong answer&apos;</span><br><span class="line">    popup = Popup(title=&apos;result&apos;, content=Label(text=s), auto_dismiss=True)</span><br><span class="line">    popup.open()</span><br></pre></td></tr></table></figure></p>
<p>逻辑很简单，但HITB{this_is_not_flag}不是答案，还是骗人的。<br>注意到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b64 = &apos;eJzF1MtOE2EUB/DzTculUKAUKJSr3OqIV0TBGEOMRqIuatJhowsndTrVA+MlnYEYhZXEhQuXLlz4CC58BBc+ggsfwYWPYDznhHN8BJr5Tv7fby6Z8/VrIzj+eDRu0kirVFoARwCPAGI6HOx4EBI6CHy+LHLH1/O4zfd8onQAsEOHg0MHmQcHDt45vmc3B50FyHIQELU8qLZyYutmebIusftm3WQ9Yo/NeskKYh2zPrJ+sfdmRbIBsc9mg2RDYl/NSmTDYt/NymQjYj/NRsnGxH6bVcjGxf6aTZBVxcpObdL6rZlNkU2LXTebsT7qZrP2fk/M5shOie2bzdvzPpgtkC2KfTFbIlsW+2ZWIzst9sPMJzsj9stsheys2B+zc2TnxTxP7YL1UTG7aLZidolsVWzT7LL11jBbI7si1ja7SrYu9sZsw+yjWJaHgHZx4F+j/VnHOao4TCXjvbuBQxqXsV9jgDmNt7CiMURP4zZOaXyA3RrncVTjEpY0djCv8S2Oa3yF/OtC0PldLPN8hkuf4ioO8nxA5zWc1LiITuM97NG4hbMaD3FE4z4W+TEFLhOKD7GL59M6r+OYxjXsperz+YzfvZ00n0rI4tdZxkuTxC8yPr3VTNJYTm139mL5S5BZGidteVTqc4dSMil8V/Qsjnb52vSIzRVdGfKu5E5seHWfu2rw3sj460yjTkwt8oqFYZQ00zQM/3cipSErzQt14/nL1l4Sb0pHXAp3/gENPMQt&apos;</span><br><span class="line">eval(marshal.loads(zlib.decompress(binascii.a2b_base64(b64))))</span><br></pre></td></tr></table></figure></p>
<p>说明程序可能进行了动态的加载和替换。<br>将zlib.decompress(binascii.a2b_base64(b64))后的内容实际上是PythonCodeObject对象，通过查找资料，可以将该对象转化为.pyc文件，进而反编译。<br>转换代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import py_compile</span><br><span class="line">import imp</span><br><span class="line">import os</span><br><span class="line">import binascii</span><br><span class="line">import zlib</span><br><span class="line">import marshal</span><br><span class="line"></span><br><span class="line">def pycodeobject2pyc(pyobj, pycfile):</span><br><span class="line">    with open(pycfile, &apos;wb&apos;) as fc: </span><br><span class="line">        fc.write(&apos;\0\0\0\0&apos;)</span><br><span class="line">        timestamp = long(os.fstat(fc.fileno()).st_mtime)</span><br><span class="line">        py_compile.wr_long(fc, timestamp)</span><br><span class="line">        marshal.dump(pyobj, fc)</span><br><span class="line">        fc.flush()</span><br><span class="line">        fc.seek(0, 0)</span><br><span class="line">        MAGIC = imp.get_magic()</span><br><span class="line">        fc.write(MAGIC)</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">        b64 = &apos;eJzF1MtOE2EUB/DzTculUKAUKJSr3OqIV0TBGEOMRqIuatJhowsndTrVA+MlnYEYhZXEhQuXLlz4CC58BBc+ggsfwYWPYDznhHN8BJr5Tv7fby6Z8/VrIzj+eDRu0kirVFoARwCPAGI6HOx4EBI6CHy+LHLH1/O4zfd8onQAsEOHg0MHmQcHDt45vmc3B50FyHIQELU8qLZyYutmebIusftm3WQ9Yo/NeskKYh2zPrJ+sfdmRbIBsc9mg2RDYl/NSmTDYt/NymQjYj/NRsnGxH6bVcjGxf6aTZBVxcpObdL6rZlNkU2LXTebsT7qZrP2fk/M5shOie2bzdvzPpgtkC2KfTFbIlsW+2ZWIzst9sPMJzsj9stsheys2B+zc2TnxTxP7YL1UTG7aLZidolsVWzT7LL11jBbI7si1ja7SrYu9sZsw+yjWJaHgHZx4F+j/VnHOao4TCXjvbuBQxqXsV9jgDmNt7CiMURP4zZOaXyA3RrncVTjEpY0djCv8S2Oa3yF/OtC0PldLPN8hkuf4ioO8nxA5zWc1LiITuM97NG4hbMaD3FE4z4W+TEFLhOKD7GL59M6r+OYxjXsperz+YzfvZ00n0rI4tdZxkuTxC8yPr3VTNJYTm139mL5S5BZGidteVTqc4dSMil8V/Qsjnb52vSIzRVdGfKu5E5seHWfu2rw3sj460yjTkwt8oqFYZQ00zQM/3cipSErzQt14/nL1l4Sb0pHXAp3/gENPMQt&apos;</span><br><span class="line">        data = marshal.loads(zlib.decompress(binascii.a2b_base64(b64)))</span><br><span class="line">        pycodeobject2pyc(data, &quot;apk2.pyc&quot;)</span><br></pre></td></tr></table></figure></p>
<p>该段代码参考了<a href="https://segmentfault.com/q/1010000003052356" target="_blank" rel="noopener">https://segmentfault.com/q/1010000003052356</a></p>
<p>PythonCodeObject转换为.pyc也费了一番功夫，基础不扎实，不知道该怎么处理。太菜了。<br>再次用uncompyle6进行反编译得到真正的check代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">def check(self):</span><br><span class="line">    s = self.flag.text</span><br><span class="line">    if len(s) != 31:</span><br><span class="line">        return False</span><br><span class="line">    if s[17] != &apos;7&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[15] != &apos;%&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[11] != &apos;S&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[3] != &apos;B&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[22] != &apos;_&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[2] != &apos;T&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[27] != &apos;O&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[6] != &apos;!&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[20] != &apos;$&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[16] != &apos;r&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[4] != &apos;&#123;&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[23] != &apos;p&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[25] != &apos;7&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[0] != &apos;H&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[18] != &apos;_&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[29] != &apos;!&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[10] != &apos;1&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[14] != &apos;H&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[13] != &apos;&amp;&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[26] != &apos;#&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[1] != &apos;I&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[7] != &apos;F&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[30] != &apos;&#125;&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[19] != &apos;v&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[12] != &apos;_&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[9] != &apos;_&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[24] != &apos;Y&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[5] != &apos;1&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[28] != &apos;N&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[21] != &apos;3&apos;:</span><br><span class="line">        return False</span><br><span class="line">    if s[8] != &apos;3&apos;:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">screen.__class__.check = check!</span><br></pre></td></tr></table></figure></p>
<p>此处才是真正进行逻辑判断的函数<br>手动排序得到flag：<br><strong>HITB{1!F3_1S_&amp;H%r7_v$3_pY7#ON!}</strong></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    post.last_updated<time datetime="2018-04-15T15:23:12.878Z" itemprop="dateUpdated">2018-04-15 23:23:12</time>
</span><br>


        
        感谢阅读
        
    </div>
    
    <footer>
        <a href="http://www.w4ter5heep.com">
            <img src="/img/gogo.jpg" alt="W4ter5heep">
            W4ter5heep
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mobile/">Mobile</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&title=《HITB2018线上赛——Mobile》 — W4ter5heep's site&pic=http://www.w4ter5heep.com/img/gogo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&title=《HITB2018线上赛——Mobile》 — W4ter5heep's site&source=Coding is fun!" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《HITB2018线上赛——Mobile》 — W4ter5heep's site&url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&via=http://www.w4ter5heep.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/04/05/hellow-my-site/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">hellow_my_site</h4>
      </a>
    </div>
  
</nav>



    

















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>W4ter5heep &copy; 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&title=《HITB2018线上赛——Mobile》 — W4ter5heep's site&pic=http://www.w4ter5heep.com/img/gogo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&title=《HITB2018线上赛——Mobile》 — W4ter5heep's site&source=Coding is fun!" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《HITB2018线上赛——Mobile》 — W4ter5heep's site&url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/&via=http://www.w4ter5heep.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.w4ter5heep.com/2018/04/15/HITB2018线上赛——Mobile/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtElEQVR42u3a0WqlQBAE0Pz/T2dhnxaySlW3kxg4PokRnWNgem71fHzEx+ff4+uVf69fnd8/7etzrt5y/8zVgYeHhzca+tVxf889NbmSMPLx/OcT4OHh4R3jbabvvJzcz9v31KTw4OHh4b2Nl/y1ndbbsoGHh4f323mz5e/mM+Hh4eG9h5fEDbNBzBbWyXsfzlrw8PDwYl4bK7zh/GB/Dw8PD2/RVW/bXZtlel5gitHi4eHhHeDlDad9DJE8IX9XcSceHh7eo7x2M9MmsCiC1yA4jqJhPDw8vAO8TXup3RTVlo1kYV1XPzw8PLw1rw0d8uvtsjsvCcWHxsPDw/sW3ixybRtUyeDyz3T5Xjw8PLwDvFksuzmftc0227Pw8PDwTvDyIpFMxPkmgPwJmy1ieHh4eOd4m3A2j2vbltus2ODh4eGd4xWt98WGgFmxqf8z7W8FPDw8vPV6Nf+Rn7ygHXpOas/x8PDwnuXlW5qeCmo3mw8+ywMPDw/vBG82Weeh7SaEbVtcq7qHh4eHV/Lyn/1twWi3I9yXqNnz8fDw8E7w2twiWSgXKUhZhNrAAg8PD+80bzZlt4ObtbiSEBkPDw/vNC+JcWdha14G8lKEh4eH9wbeJkjNNw3kbbZ9oysKkfHw8PDWvNnknk/6yXSf39Mu0/Hw8PCe5eWwtk01W2TnY4hKDh4eHt4P8Wahw7NRb/4h6oqHh4eHV/LyMCKnzjYEbELbB7IWPDw8vJi3CUw37f9ZzNG26PDw8PBO8GYTbhtDzPCzcAQPDw/ve3jPtvzzrQBtoDBcauPh4eEd47WNqH24sPmURcXDw8PD+1Feu0UgjzBmK/3oCXh4eHgv4O0DgtnWgaQhd7k/Ag8PD+8Arw0j2lR4FlXMtibg4eHhnebtG2BJANF+uM3nqA88PDy89M4/0EQr8MFyNZkAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '你看不到我了哦！';
            clearTimeout(titleTime);
        } else {
            document.title = '哇，你回来了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
